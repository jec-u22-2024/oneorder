"use strict";(self["webpackChunktableorder4"]=self["webpackChunktableorder4"]||[]).push([[408],{1408:function(t,e,s){s.r(e),s.d(e,{default:function(){return T}});var l=s(6768),a=s(4232),i=s(5130);const o={class:"history-wrap"},r={class:"header"},d={class:"time-date"},n={class:"date-buttons"},c=(0,l.Lk)("div",{class:"noneBlock"},null,-1),u={class:"container"},h={class:"order-grid"},g=(0,l.Lk)("div",{class:"modal history-modal"},[(0,l.Lk)("p",{class:"loading-text"},"検索中...")],-1),y={class:"order-table-container"},k={class:"order-table"},p=(0,l.Lk)("thead",null,[(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"伝票番号"),(0,l.Lk)("th",null,"日付"),(0,l.Lk)("th",null,"テーブル番号"),(0,l.Lk)("th",null,"合計金額")])],-1),L={key:0,id:"order-table-body"},b=["onClick"],v={class:"slip-id"},m={class:"order-date"},_={key:0,class:"table-number"},C={key:1,class:"table-number"},D={key:1},E=(0,l.Lk)("tr",null,[(0,l.Lk)("td",{colspan:"5"},"取引がありません")],-1),S=[E],X={key:0,class:"order-table-page"},x={class:"page-index"},I={id:"order-details-container",class:"order-details-container"},w={key:0,class:"order-details"},f=(0,l.Lk)("br",null,null,-1),H=(0,l.Lk)("br",null,null,-1),M=(0,l.Lk)("br",null,null,-1),N=(0,l.Lk)("h4",null,"注文商品一覧",-1),q={key:0,class:"order-items-table"},A=(0,l.Lk)("tr",null,[(0,l.Lk)("th",null,"商品名"),(0,l.Lk)("th",null,"注文数"),(0,l.Lk)("th",null,"価格")],-1),$={key:0},F={key:1},W={key:2},Q={key:3};function j(t,e,s,E,j,K){return(0,l.uX)(),(0,l.CE)("div",o,[(0,l.Lk)("div",r,[(0,l.Lk)("span",d,(0,a.v_)(j.dateNow.toLocaleString()),1),(0,l.Lk)("div",n,[(0,l.Lk)("button",{id:"prev-date",onClick:e[0]||(e[0]=t=>K.setLogDate(-1))},"<"),(0,l.bo)((0,l.Lk)("input",{type:"date",name:"logdate",id:"logdates","onUpdate:modelValue":e[1]||(e[1]=t=>j.logStr=t),onChange:e[2]||(e[2]=(...t)=>K.getHistory&&K.getHistory(...t))},null,544),[[i.Jo,j.logStr]]),(0,l.Lk)("button",{id:"next-date",onClick:e[3]||(e[3]=t=>K.setLogDate(1))},">")]),c]),(0,l.Lk)("div",u,[(0,l.Lk)("div",h,[g,(0,l.Lk)("div",y,[(0,l.Lk)("table",k,[p,j.historys.length>0?((0,l.uX)(),(0,l.CE)("tbody",L,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(j.historys,((t,e)=>((0,l.uX)(),(0,l.CE)("tr",{key:e,class:"table-line",onClick:e=>K.getAbout(t)},[(0,l.Lk)("td",v,(0,a.v_)(t.slip_id),1),(0,l.Lk)("td",m,(0,a.v_)(t.transaction_datetime),1),t.table_number?((0,l.uX)(),(0,l.CE)("td",_,(0,a.v_)(t.table_number),1)):((0,l.uX)(),(0,l.CE)("td",C,"削除されたテーブルです")),(0,l.Lk)("td",null,"¥"+(0,a.v_)(t.total_price),1)],8,b)))),128))])):((0,l.uX)(),(0,l.CE)("tbody",D,S))]),j.orders.length/8>1?((0,l.uX)(),(0,l.CE)("div",X,[(0,l.Lk)("button",{class:"page-btn",type:"button",onClick:e[4]||(e[4]=t=>K.changeIdx(1))},"<"),(0,l.Lk)("span",x,(0,a.v_)(j.pageIdx),1),(0,l.Lk)("button",{class:"page-btn",type:"button",onClick:e[5]||(e[5]=t=>K.changeIdx(-1))},">")])):(0,l.Q3)("",!0)]),(0,l.Lk)("div",I,[null!=j.details.slip_id?((0,l.uX)(),(0,l.CE)("div",w,[(0,l.Lk)("h3",null,"取引詳細 : "+(0,a.v_)(j.details.slip_id),1),(0,l.Lk)("p",null,[(0,l.eW)("来店時間: "+(0,a.v_)(j.details.transaction_datetime),1),f,(0,l.eW)(" 合計: ¥"+(0,a.v_)(j.details.bills),1),H,(0,l.eW)(" お預り: ¥"+(0,a.v_)(j.details.received),1),M,(0,l.eW)(" おつり: ¥"+(0,a.v_)(j.details.received-j.details.bills),1)]),N,j.details.orders?((0,l.uX)(),(0,l.CE)("table",q,[A,((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(j.details.orders,(t=>((0,l.uX)(),(0,l.CE)("tr",{key:t.id},[t.name?((0,l.uX)(),(0,l.CE)("td",$,(0,a.v_)(t.name),1)):((0,l.uX)(),(0,l.CE)("td",F,"削除された商品です")),(0,l.Lk)("td",null,(0,a.v_)(t.amount),1),t.total_price?((0,l.uX)(),(0,l.CE)("td",W,"¥"+(0,a.v_)(t.total_price),1)):((0,l.uX)(),(0,l.CE)("td",Q,"削除された商品のため取得できません"))])))),128))])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])])])])}s(4114);var K=s(4821),Y={data(){return{orders:[],historys:[],dateNow:new Date,logDate:new Date,logStr:"",details:{},pageIdx:1}},mounted(){this.logStr=this.formatDate(this.logDate,"yyyy-MM-dd"),this.getHistory(),this.$emit("setDisplay","history"),setInterval((()=>{this.dateNow=new Date}),1e3),this.logDate=new Date(this.dateNow.getFullYear(),this.dateNow.getMonth(),this.dateNow.getDate())},emits:["setDisplay"],methods:{setLogDate(t){t+=this.logDate.getDate(),this.logDate.setDate(t),this.logStr=this.formatDate(this.logDate,"yyyy-MM-dd"),this.getHistory()},getHistory(){const t=document.querySelector(".active");t&&(t.classList.remove("active"),this.details={}),this.$el.querySelector(".history-modal").style.display="";const e=this.logStr;(0,K.A)(`/api/master/historys/${e}`).then((t=>t.json())).then((t=>{this.orders=t,this.pageIdx=1,setTimeout((()=>{this.getHistorys(0,7)}),500)})),this.logDate=new Date(e)},getAbout(t){const e=document.querySelectorAll(".table-line");e.forEach((t=>t.classList.remove("active")));const s=[].map.call(e,(t=>t)),l=s.filter((e=>Number.parseInt(e.querySelector(".slip-id").textContent)===t.slip_id));l&&(l[0].classList.add("active"),this.getDetails(t))},getDetails(t){(0,K.A)(`/api/master/history/details/${t.slip_id}`).then((t=>t.json())).then((e=>{e.length>0&&(this.details.slip_id=t.slip_id,this.details.transaction_datetime=t.transaction_datetime,this.details.bills=t.total_price,this.details.received=t.received,this.details.orders=e)}))},changeIdx(t){const e=document.querySelector(".active");e&&(e.classList.remove("active"),this.details={});const s=7;t>0?this.orders.length/8>this.pageIdx&&this.pageIdx++:this.pageIdx>1&&this.pageIdx--;const l=s*(this.pageIdx-1),a=l+s;l>0?this.getHistorys(l+1,a):this.getHistorys(l,a)},getHistorys(t,e){this.historys=[],this.orders.forEach(((s,l)=>{t<=l&&l<=e&&this.historys.push(s)})),this.$el.querySelector(".history-modal").style.display="none"},formatDate(t,e){return e=e.replace(/yyyy/g,t.getFullYear()),e=e.replace(/MM/g,("0"+(t.getMonth()+1)).slice(-2)),e=e.replace(/dd/g,("0"+t.getDate()).slice(-2)),e=e.replace(/HH/g,("0"+t.getHours()).slice(-2)),e=e.replace(/mm/g,("0"+t.getMinutes()).slice(-2)),e=e.replace(/ss/g,("0"+t.getSeconds()).slice(-2)),e=e.replace(/SSS/g,("00"+t.getMilliseconds()).slice(-3)),e}}},B=s(1241);const J=(0,B.A)(Y,[["render",j]]);var T=J}}]);
//# sourceMappingURL=408.js.map